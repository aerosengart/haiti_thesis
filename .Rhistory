library("gridExtra")
library(doParallel)
source("mod_tools.R")
source("forecast_tools.R")
source("mod_build.R")
source("haiti1_vacscen.R")
source("haiti1.R")
source("haiti1_joint.R")
source("haiti1_agg_data.R")
source("haiti1_data.R")
plot_sim_dat <- function(simdat) {
plt <- ggplot(simdat, aes(x = week)) +
geom_line(aes(y = cases), colour = "blue", alpha = 0.5) +
geom_point(aes(y = orig), size = 1) +
theme_bw() +
xlim(0, 430) +
scale_y_continuous("cases", limits = c(0, 30000), oob = scales::squish)
return(plt)
}
haiti_dat <- haiti1_agg_data()
################################################################################
## Reproduction - Figure A1                                                   ##
################################################################################
load("data/orig_mod/epi/epidemic_fit.rda")
epi_pars <- prof_if
parsepi_3000 <- epi_pars %>%
dplyr::filter(nu > 0.9) %>%
dplyr::filter(beta1 < 100 & beta2 < 100 & beta3 < 100 & beta4 < 100 & beta5 < 100 & beta6 < 100)
parids_epi <- parsepi_3000$parid %>% as.data.frame()
load("data/orig_mod/end/orig_end_mif.rda")
end_pars <- prof_if
parsend_3000 <- end_pars %>%
dplyr::filter(loglik > -3000)
parids_end <- parsend_3000$parid %>% as.data.frame()
parids <- dplyr::inner_join(parids_end, parids_epi)
parids <- parids$.
epi_recs_fullpath <- c(paste0("data/orig_mod/epi/fitstates_if_epi232_nprofs3_nmif100_nparticles100_parid",
parids, "_seed20190415.csv"))
end_recs_fullpath <- c(paste0("data/orig_mod/end/fitstates_if_parid",
parids, ".csv"))
simdat_epi <- process_fitstates(epi_recs_fullpath, haiti_dat_epi)
simdat_end <- process_fitstates(end_recs_fullpath, haiti_dat_end) %>%
dplyr::filter(week > 232) %>%
dplyr::select(-week_end)
simdat_all <- rbind(simdat_epi, simdat_end)
simdat_all$period <- ifelse(simdat_all$week < 233, "epidemic", "endemic")
simdat_all_log <- simdat_all %>%
dplyr::mutate(orig_cases = log(orig_cases  + 1),
est_med = log(est_med + 1),
est_lo = log(est_lo + 1),
est_hi = log(est_hi + 1))
reprod_plot <- plot_fit_full_wribbon(simdat_all)
all_plot_log <- plot_fit_full_wribbon(simdat_all_log)
## Reproduction Likelihood
best_pars_epi_reprod <- parsepi_3000[which.max(parsepi_3000$loglik), ]
best_pars_end_reprod <- parsend_3000[which.max(parsend_3000$loglik), ]
allpars <- c("rho","tau","beta1","beta2","beta3","beta4","beta5","beta6",
"gamma","sigma","theta0","alpha","mu","delta","nu",
"S_0","E_0","I_0","A_0","R_0", "pop_0")
reprod_epi_params <- best_pars_epi_reprod[colnames(best_pars_epi_reprod) %in% allpars]
reprod_end_params <- best_pars_end_reprod[colnames(best_pars_end_reprod) %in% allpars]
episettings <- fix_epi_settings(nprofs = 3, nparticles = 5000, nmif = 150)
fcsettings <- fix_fc_vac_settings("id0", nsims = 25)
## get case data (epidemic period)
haiti_dat_epi <- haiti_dat %>% dplyr::filter(week <= episettings$nweeks)
## get case data (endemic period)
haiti_dat_end <- haiti_dat %>% dplyr::filter(week > episettings$nweeks) %>%
dplyr::mutate(week_end = seq_along(week))
## make table of covariates for seasonality
covartab <- make_covartab(0, nrow(haiti_dat) + fcsettings$horizon + 1, byt = 1,
degree = 6, nbasis = 6, per = 52.14)
full_mod <- mod_build(dat = haiti_dat, covar = covartab)
source("mod_vis.R")
epi_mod <- haiti1()
source("haiti1_covars.R")
epi_mod <- haiti1()
joint_mod <- haiti1_joint()
load("data/orig_mod/epi/epidemic_fit.rda")
epi_pars <- prof_if
parsepi_3000 <- epi_pars %>%
dplyr::filter(nu > 0.9) %>%
dplyr::filter(beta1 < 100 & beta2 < 100 & beta3 < 100 & beta4 < 100 & beta5 < 100 & beta6 < 100)
parids_epi <- parsepi_3000$parid %>% as.data.frame()
load("data/orig_mod/end/orig_end_mif.rda")
end_pars <- prof_if
parsend_3000 <- end_pars %>%
dplyr::filter(loglik > -3000)
parids_end <- parsend_3000$parid %>% as.data.frame()
parids <- dplyr::inner_join(parids_end, parids_epi)
parids <- parids$.
epi_recs_fullpath <- c(paste0("data/orig_mod/epi/fitstates_if_epi232_nprofs3_nmif100_nparticles100_parid",
parids, "_seed20190415.csv"))
end_recs_fullpath <- c(paste0("data/orig_mod/end/fitstates_if_parid",
parids, ".csv"))
simdat_epi <- process_fitstates(epi_recs_fullpath, haiti_dat_epi)
simdat_end <- process_fitstates(end_recs_fullpath, haiti_dat_end) %>%
dplyr::filter(week > 232) %>%
dplyr::select(-week_end)
simdat_all <- rbind(simdat_epi, simdat_end)
simdat_all$period <- ifelse(simdat_all$week < 233, "epidemic", "endemic")
simdat_all_log <- simdat_all %>%
dplyr::mutate(orig_cases = log(orig_cases  + 1),
est_med = log(est_med + 1),
est_lo = log(est_lo + 1),
est_hi = log(est_hi + 1))
reprod_plot <- plot_fit_full_wribbon(simdat_all)
all_plot_log <- plot_fit_full_wribbon(simdat_all_log)
all_plot_log
reprod_plot <- plot_fit_full_wribbon(simdat_all)
reprod_plot_log <- plot_fit_full_wribbon(simdat_all_log)
ggsave(reprod_plot, file = "reprod_plot.png", width = 6, height = 4)
ggsave(reprod_plot_log, file = "reprod_plot_log.png", width = 6, height = 4)
reprod_plot <- plot_fit_full_wribbon(simdat_all) + ggtitle("Reproduction Plot")
reprod_plot
reprod_plot <- plot_fit_full_wribbon(simdat_all) + ggtitle("Reproduction Plot: Natural Scale")
reprod_plot_log <- plot_fit_full_wribbon(simdat_all_log) + ggtitle("Reproduction Plot: Log Scale")
ggsave(reprod_plot, file = "reprod_plot.png", width = 6, height = 4)
ggsave(reprod_plot_log, file = "reprod_plot_log.png", width = 6, height = 4)
reprod_plot_log <- plot_fit_full_wribbon(simdat_all_log) + ggtitle("Reproduction Plot: Log Scale") + ylab("log(Reported Cases + 1")
ggsave(reprod_plot_log, file = "reprod_plot_log.png", width = 6, height = 4)
################################################################################
## Adjusted Model Simulation Plot - Figure 3                                  ##
################################################################################
load(file = "data/pruned_epi.rda")
epi_par_df <- pruned_epi
best_pars <- epi_par_df[which.max(epi_par_df$loglik), ]
allpars <- c("rho","tau","beta1","beta2","beta3","beta4","beta5","beta6",
"gamma","sigma","theta0","alpha","mu","delta","nu", "sig_sq",
"S_0","E_0","I_0","A_0","R_0", "pop_0")
adj_epi_params <- best_pars[colnames(best_pars) %in% allpars]
epi_mod <- haiti1()
simdat_mle_epi <- sim_data(epi_mod, adj_epi_params, 25)
load(file = "data/pruned_end.rda")
end_par_df <- pruned_end
best_pars <- end_par_df[which.max(end_par_df$loglik), ]
allpars <- c("rho","tau","beta1","beta2","beta3","beta4","beta5","beta6",
"gamma","sigma","theta0","alpha","mu","delta","nu", "sig_sq",
"S_0","E_0","I_0","A_0","R_0", "pop_0")
adj_end_params <- best_pars[colnames(best_pars) %in% allpars]
end_mod <- haiti1(period = "endemic")
simdat_mle_end <- sim_data(end_mod, adj_end_params, 25)
simdat_mle <- rbind(simdat_mle_epi, simdat_mle_end)
simdat_mle <- simdat_mle %>%
dplyr::left_join(haiti_dat, by = c("week")) %>%
dplyr::rename(est_lo = cases_lo,
est_hi = cases_hi,
est_med = cases_med,
orig_cases = cases)
simdat_mle$period <- ifelse(simdat_mle$week < 233, "epidemic", "endemic")
simdat_mle_log <- simdat_mle %>%
dplyr::mutate(orig_cases = log(orig_cases  + 1),
est_med = log(est_med + 1),
est_lo = log(est_lo + 1),
est_hi = log(est_hi + 1))
mle_plot_adj <- plot_fit_full_wribbon(simdat_mle) + ggtitle("Adjusted Model Plot: Natural Scale")
mle_plot_log <- plot_fit_full_wribbon(simdat_mle_log) + ggtitle("Adjusted Model Plot: Log Scale") + ylab("log(Reported Cases + 1)")
mle_plot_adj
mle_plot_log <- plot_fit_full_wribbon(simdat_mle_log) + ggtitle("Adjusted Model Plot: Log Scale") + ylab("log(Reported Cases + 1)")
mle_plot_log
ggsave(mle_plot_adj, file = "mle_plot_adj.png", width = 6, height = 4)
ggsave(mle_plot_log, file = "mle_plot_log.png", width = 6, height = 4)
################################################################################
## Profile Likelihood - Figure 4                                              ##
################################################################################
load("data/profile_likelihood_sigsq_epi.rda")
################################################################################
## Adjusted, Joint Model Plot - Figure 5                                      ##
################################################################################
load("data/joint_mif_ssqtaurho.rda")
joint_mod <- haiti1_joint()
best_pars <- prof_if[which.max(prof_if$full_loglik), ] %>%
select(-c(1:2, 29:34)) %>%
rename(beta1 = beta1_joint,
beta2 = beta2_joint,
beta3 = beta3_joint,
beta4 = beta4_joint,
beta5 = beta5_joint,
beta6 = beta6_joint)
simdat_test <- sim_data(joint_mod, best_pars, 50) %>%
dplyr::left_join(haiti_dat, by = c("week")) %>%
dplyr::rename(est_lo = cases_lo,
est_hi = cases_hi,
est_med = cases_med,
orig_cases = cases)
simdat_test$period <- ifelse(simdat_test$week < 233, "epidemic", "endemic")
simdat_mle_log <- simdat_mle %>%
dplyr::mutate(orig_cases = log(orig_cases  + 1),
est_med = log(est_med + 1),
est_lo = log(est_lo + 1),
est_hi = log(est_hi + 1))
mle_plot_joint <- plot_fit_full_wribbon(simdat_test)+ ggtitle("Adjusted, Joint Model Plot: Natural Scale")
mle_plot_log <- plot_fit_full_wribbon(simdat_mle_log) + ggtitle("Adjusted, Joint Model Plot: Log Scale") + ylab("log(Reported Cases + 1)")
ggsave(mle_plot_joint, file = "mle_plot_joint.png", width = 6, height = 4)
ggsave(mle_plot_log, file = "mle_plot_joint_log.png", width = 6, height = 4)
################################################################################
## Adjusted, Joint Model Plot - Figure 5                                      ##
################################################################################
load("data/joint_mif_ssqtaurho.rda")
joint_mod <- haiti1_joint()
################################################################################
## Adjusted, Joint Model Plot - Figure 5                                      ##
################################################################################
load("data/joint_mif_ssqtaurho.rda")
joint_mod <- haiti1_joint()
best_pars <- prof_if[which.max(prof_if$full_loglik), ] %>%
select(-c(1:2, 29:34)) %>%
rename(beta1 = beta1_joint,
beta2 = beta2_joint,
beta3 = beta3_joint,
beta4 = beta4_joint,
beta5 = beta5_joint,
beta6 = beta6_joint)
simdat_test <- sim_data(joint_mod, best_pars, 50) %>%
dplyr::left_join(haiti_dat, by = c("week")) %>%
dplyr::rename(est_lo = cases_lo,
est_hi = cases_hi,
est_med = cases_med,
orig_cases = cases)
simdat_test$period <- ifelse(simdat_test$week < 233, "epidemic", "endemic")
simdat_mle_log <- simdat_test %>%
dplyr::mutate(orig_cases = log(orig_cases  + 1),
est_med = log(est_med + 1),
est_lo = log(est_lo + 1),
est_hi = log(est_hi + 1))
mle_plot_joint <- plot_fit_full_wribbon(simdat_test)+ ggtitle("Adjusted, Joint Model Plot: Natural Scale")
mle_plot_joint_log <- plot_fit_full_wribbon(simdat_mle_log) + ggtitle("Adjusted, Joint Model Plot: Log Scale") + ylab("log(Reported Cases + 1)")
mle_plot_joint
mle_plot_joint_log
library("cowplot")
View(simdat_test)
inset_dat <- simdat_test %>%
dplyr::filter(week > 232)
inset <- plot_fit_full_wribbon(simdat_test)
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = 0.07, y = .7, width = .3, height = .3)
plot.with.inset
inset <- plot_fit_full_wribbon(simdat_test) + theme(legend.position = "none")
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = 0.07, y = .7, width = .3, height = .3)
inset <- plot_fit_full_wribbon(simdat_test) + theme(legend.position = "none")
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = 0.07, y = .7, width = .3, height = .3)
plot.with.inset
inset <- plot_fit_full_wribbon(simdat_test) + theme(legend.position = "none", axis.title.x=element_blank(), axis.title.y=element_blank())
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = 0.07, y = .7, width = .3, height = .3)
plot.with.inset
inset <- plot_fit_full_wribbon(inset_dat) + theme(legend.position = "none", axis.title.x=element_blank(), axis.title.y=element_blank())
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = 0.07, y = .7, width = .3, height = .3)
plot.with.inset
inset <- plot_fit_full_wribbon(inset_dat) + theme(legend.position = "none", axis.title.x=element_blank(), axis.title.y=element_blank(), axis.text.x = element_text(size = 4))
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = 0.07, y = .7, width = .3, height = .3)
plot.with.inset
inset <- plot_fit_full_wribbon(inset_dat) + theme(legend.position = "none",
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x = element_text(size = 6),
axis.text.y = element_text(size = 6))
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .6, y = .6, width = .3, height = .3)
plot.with.inset
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .6, y = .6, width = .6, height = .3)
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .6, y = .6, width = .3, height = .3)
plot.with.inset
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .6, y = .6, width = 1, height = .3)
plot.with.inset
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .5, y = .6, width = .8, height = .4)
plot.with.inset
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .5, y = .5, width = .7, height = .3)
plot.with.inset
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .3, y = .4, width = .7, height = .3)
plot.with.inset
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .3, y = .4, width = .5, height = .3)
plot.with.inset
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .5, y = .55, width = .5, height = .3)
plot.with.inset
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .45, y = .55, width = .5, height = .3)
plot.with.inset
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .45, y = .55, width = .55, height = .4)
plot.with.inset
plot.with.inset
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .45, y = .5, width = .55, height = .4)
plot.with.inset
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .4, y = .5, width = .55, height = .4)
plot.with.inset
ggsave(plot.with.inset, file = "plot.with.inset.png", width = 6, height = 4)
inset_dat <- simdat_test %>%
dplyr::filter(week > 200)
inset <- plot_fit_full_wribbon(inset_dat) + theme(legend.position = "none",
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x = element_text(size = 6),
axis.text.y = element_text(size = 6))
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .4, y = .5, width = .55, height = .4)
ggsave(plot.with.inset, file = "plot.with.inset.png", width = 6, height = 4)
inset_dat <- simdat_test %>%
dplyr::filter(week > 280)
inset <- plot_fit_full_wribbon(inset_dat) + theme(legend.position = "none",
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x = element_text(size = 6),
axis.text.y = element_text(size = 6))
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .4, y = .5, width = .55, height = .4)
ggsave(plot.with.inset, file = "plot.with.inset.png", width = 6, height = 4)
inset_dat <- simdat_test %>%
dplyr::filter(week > 180)
inset <- plot_fit_full_wribbon(inset_dat) + theme(legend.position = "none",
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x = element_text(size = 6),
axis.text.y = element_text(size = 6))
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .4, y = .5, width = .55, height = .4)
inset_dat <- simdat_test %>%
dplyr::filter(week > 180)
ggsave(plot.with.inset, file = "plot.with.inset.png", width = 6, height = 4)
mle_plot_joint_log <- plot_fit_full_wribbon(simdat_mle_log) + ggtitle("Adjusted, Joint Model Plot: Log Scale") + ylab("log(Reported Cases + 1)")
ggsave(mle_plot_joint_log, file = "logscale_plot.png", width = 6, height = 4)
View(simdat_test)
inset_dat <- simdat_test %>%
dplyr::filter(week > 15)
inset <- plot_fit_full_wribbon(inset_dat) + theme(legend.position = "none",
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x = element_text(size = 6),
axis.text.y = element_text(size = 6))
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .4, y = .5, width = .55, height = .4)
plot.with.inset
inset_dat <- simdat_test %>%
dplyr::filter(week > 115)
inset <- plot_fit_full_wribbon(inset_dat) + theme(legend.position = "none",
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x = element_text(size = 6),
axis.text.y = element_text(size = 6))
plot.with.inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .4, y = .5, width = .55, height = .4)
plot.with.inset
joint_inset <-
ggdraw() +
draw_plot(mle_plot_joint) +
draw_plot(inset, x = .4, y = .5, width = .55, height = .4)
ggsave(joint_inset, file = "joint_inset.png", width = 6, height = 4)
ggsave(joint_inset, file = "joint_inset.png", width = 8, height = 6)
mle_plot_joint <- plot_fit_full_wribbon(simdat_test) + ggtitle("Adjusted, Joint Model Plot: Natural Scale")
ggsave(mle_plot_joint, file = "mle_plot_joint.png", width = 8, height = 6)
mle_plot_joint_log <- plot_fit_full_wribbon(simdat_mle_log) + ggtitle("Adjusted, Joint Model Plot: Log Scale") + ylab("log(Reported Cases + 1)")
ggsave(mle_plot_joint_log, file = "mle_plot_joint_log.png", width = 8, height = 6)
load(file = "data/pruned_epi.rda")
epi_par_df <- pruned_epi
best_pars <- epi_par_df[which.max(epi_par_df$loglik), ]
allpars <- c("rho","tau","beta1","beta2","beta3","beta4","beta5","beta6",
"gamma","sigma","theta0","alpha","mu","delta","nu", "sig_sq",
"S_0","E_0","I_0","A_0","R_0", "pop_0")
adj_epi_params <- best_pars[colnames(best_pars) %in% allpars]
epi_mod <- haiti1()
simdat_mle_epi <- sim_data(epi_mod, adj_epi_params, 25)
load(file = "data/pruned_end.rda")
end_par_df <- pruned_end
best_pars <- end_par_df[which.max(end_par_df$loglik), ]
allpars <- c("rho","tau","beta1","beta2","beta3","beta4","beta5","beta6",
"gamma","sigma","theta0","alpha","mu","delta","nu", "sig_sq",
"S_0","E_0","I_0","A_0","R_0", "pop_0")
adj_end_params <- best_pars[colnames(best_pars) %in% allpars]
end_mod <- haiti1(period = "endemic")
simdat_mle_end <- sim_data(end_mod, adj_end_params, 25)
simdat_mle <- rbind(simdat_mle_epi, simdat_mle_end)
simdat_mle <- simdat_mle %>%
dplyr::left_join(haiti_dat, by = c("week")) %>%
dplyr::rename(est_lo = cases_lo,
est_hi = cases_hi,
est_med = cases_med,
orig_cases = cases)
simdat_mle$period <- ifelse(simdat_mle$week < 233, "epidemic", "endemic")
simdat_mle_log <- simdat_mle %>%
dplyr::mutate(orig_cases = log(orig_cases  + 1),
est_med = log(est_med + 1),
est_lo = log(est_lo + 1),
est_hi = log(est_hi + 1))
mle_plot_adj <- plot_fit_full_wribbon(simdat_mle) + ggtitle("Adjusted Model Plot: Natural Scale")
mle_plot_log <- plot_fit_full_wribbon(simdat_mle_log) + ggtitle("Adjusted Model Plot: Log Scale") + ylab("log(Reported Cases + 1)")
ggsave(mle_plot_log, file = "mle_plot_adj_log.png", width = 8, height = 6)
inset_dat <- simdat_mle %>%
dplyr::filter(week > 115)
inset <- plot_fit_full_wribbon(inset_dat) + theme(legend.position = "none",
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x = element_text(size = 6),
axis.text.y = element_text(size = 6))
adj_inset <-
ggdraw() +
draw_plot(mle_plot_adj) +
draw_plot(inset, x = .4, y = .5, width = .55, height = .4)
ggsave(adj_inset, file = "adjt_inset.png", width = 8, height = 6)
ggsave(adj_inset, file = "adj_inset.png", width = 8, height = 6)
haiti_dat <- haiti1_agg_data()
################################################################################
## Reproduction - Figure A1                                                   ##
################################################################################
load("data/orig_mod/epi/epidemic_fit.rda")
epi_pars <- prof_if
parsepi_3000 <- epi_pars %>%
dplyr::filter(nu > 0.9) %>%
dplyr::filter(beta1 < 100 & beta2 < 100 & beta3 < 100 & beta4 < 100 & beta5 < 100 & beta6 < 100)
parids_epi <- parsepi_3000$parid %>% as.data.frame()
load("data/orig_mod/end/orig_end_mif.rda")
end_pars <- prof_if
parsend_3000 <- end_pars %>%
dplyr::filter(loglik > -3000)
parids_end <- parsend_3000$parid %>% as.data.frame()
parids <- dplyr::inner_join(parids_end, parids_epi)
parids <- parids$.
epi_recs_fullpath <- c(paste0("data/orig_mod/epi/fitstates_if_epi232_nprofs3_nmif100_nparticles100_parid",
parids, "_seed20190415.csv"))
end_recs_fullpath <- c(paste0("data/orig_mod/end/fitstates_if_parid",
parids, ".csv"))
simdat_epi <- process_fitstates(epi_recs_fullpath, haiti_dat_epi)
simdat_end <- process_fitstates(end_recs_fullpath, haiti_dat_end) %>%
dplyr::filter(week > 232) %>%
dplyr::select(-week_end)
simdat_all <- rbind(simdat_epi, simdat_end)
simdat_all$period <- ifelse(simdat_all$week < 233, "epidemic", "endemic")
simdat_all_log <- simdat_all %>%
dplyr::mutate(orig_cases = log(orig_cases  + 1),
est_med = log(est_med + 1),
est_lo = log(est_lo + 1),
est_hi = log(est_hi + 1))
reprod_plot <- plot_fit_full_wribbon(simdat_all) + ggtitle("Reproduction Plot: Natural Scale")
reprod_plot_log <- plot_fit_full_wribbon(simdat_all_log) + ggtitle("Reproduction Plot: Log Scale") + ylab("log(Reported Cases + 1)")
ggsave(reprod_plot_log, file = "reprod_plot_log.png", width = 8, height = 6)
inset_dat <- simdat_all %>%
dplyr::filter(week > 115)
inset <- plot_fit_full_wribbon(inset_dat) + theme(legend.position = "none",
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x = element_text(size = 6),
axis.text.y = element_text(size = 6))
reprod_inset <-
ggdraw() +
draw_plot(reprod_plot) +
draw_plot(inset, x = .4, y = .5, width = .55, height = .4)
ggsave(reprod_inset, file = "reprod_inset.png", width = 8, height = 6)
log(4)
log(10)
log(100)
log(106)
105/100
